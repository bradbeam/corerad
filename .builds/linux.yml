image: archlinux
packages:
  - go
sources:
  - https://github.com/mdlayher/corerad
environment:
  GO111MODULE: "on"
tasks:
  - build: |
      go version
      go get honnef.co/go/tools/cmd/staticcheck
      cd corerad/
      ./scripts/cibuild.sh
      go vet ./...
      /home/build/go/bin/staticcheck ./...
      go test -race ./...
      go test -c -race ./internal/corerad/
      sudo ./corerad.test -test.run TestAdvertiser
      # Ensure a valid and sane configuration can be generated.
      go build ./cmd/corerad/
      go get github.com/BurntSushi/toml/cmd/tomlv
      ./corerad -init
      /home/build/go/bin/tomlv ./corerad.toml
